###new latest script
version: 1
backend:
  phases:
    build:
      commands:
        - npm i
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID

frontend:
  phases:
    build:
      commands:
        - npm run build

    postBuild:
      commands:
        - echo "üèó Backend & frontend build completed ‚Äî setting deployment variables..."
        - |
          if [ "$AWS_BRANCH" = "main" ]; then
            export ENVIRONMENT="prod"
          elif [ "$AWS_BRANCH" = "stage" ]; then
            export ENVIRONMENT="stage"
          else
            export ENVIRONMENT="develop"
          fi
        - export PROJECT_NAME="$PROJECT_NAME"
        - echo "üìå ENVIRONMENT = $ENVIRONMENT"
        - echo "üìå PROJECT_NAME = $PROJECT_NAME"
        - |
          echo "üöÄ Running Dora script for branch: $AWS_BRANCH"
          npm run doromatrix:watch || echo "‚ö†Ô∏è Dora script failed ‚Äî continuing build..."

  artifacts:
    baseDirectory: dist
    files:
      - '**/*'

  cache:
    paths:
      - .npm/**/*
      - node_modules/**/*
